prefix parallel

# To mark a test as flaky, list the test name in the appropriate section
# below, without ".js", followed by ": PASS,FLAKY". Example:
# sample-test                        : PASS,FLAKY

[true] # This section applies to all platforms

### Graal.js-specific ###

# PromiseHook events in graal-nodejs (for await) do not match the events generated by V8
test-async-hooks-correctly-switch-promise-hook: FAIL
test-async-hooks-execution-async-resource-await: FAIL

# Triggers stack-overflow that may not be handled well
test-async-wrap-pop-id-during-load: SKIP
test-promise-reject-callback-exception: SKIP
test-ttywrap-stack: SKIP

# Different error message
# object is not extensible versus Cannot add new property ... to non-extensible ...
test-assert-calltracker-getCalls: FAIL
# Unexpected end of input versus Expected an operand but found eof
test-cli-eval: FAIL
# Unexpected identifier versus Expected ; but found bar
test-cli-syntax-piped-bad: FAIL
test-repl-pretty-custom-stack: FAIL
test-repl-pretty-stack: FAIL
# Cannot convert undefined or null to object versus String.prototype.match called on null or undefined
test-errors-systemerror: FAIL
# Cannot read properties of null (reading 'byteLength') versus Cannot read property 'byteLength' of null
test-fs-read: FAIL
# Invalid array buffer length versus Array buffer allocation failed
test-fs-write-buffer-large: FAIL
# Invalid regular expression flags versus Invalid flags supplied to RegExp constructor ...
test-runner-string-to-regexp: FAIL
# ports is not iterable versus 0 is not iterable
test-worker-message-event: FAIL
# Unexpected number versus expected BindingIdentifier or BindingPattern
test-node-output-vm: FAIL

# Different stack-traces (for example, different column numbers)
test-node-output-errors: FAIL

# Suspicious (V8 specific?) test checking whether ArrayBufferView lives on heap
test-buffer-backing-arraybuffer: FAIL

# Tests the content of Node.js original help (--help option).
# We print a different help message.
test-cli-node-print-help: FAIL

# Suspicious test - executes a memory intensive section and then
# looks for a memory leak by checking whether rss was increased
# It fails because JVM increases its heap size and does not decrease
# it once the memory intensive section is done (despite there is no
# memory leak).
test-crypto-dh-leak: SKIP
test-worker-memory: SKIP

# Callback of FinalizationRegistry called too late (after exit event)
test-finalization-registry-shutdown: PASS,FAIL

# Uses v8 extension (--expose_externalize_string flag that exposes two additional functions)
test-fs-write: FAIL

# uses V8 internal methods (%HaveSameMap, %CollectGarbage, %DebugPrint)
test-http-same-map: FAIL
test-v8-flags: FAIL

# heapsnapshot/heapdump/EmbedderGraph is not supported
test-heapdump-async-hooks-init-promise: SKIP
test-heapsnapshot-near-heap-limit-by-api-in-worker: SKIP
test-heapsnapshot-near-heap-limit-worker: SKIP
test-http2-ping-settings-heapdump: SKIP
test-v8-getheapsnapshot-twice: SKIP
test-worker-exit-heapsnapshot: SKIP
test-worker-heap-snapshot: SKIP

# https://example.com does not work in CI
test-https-agent-unref-socket: SKIP

# missing support for ModifyCodeGenerationFromStringsCallback
test-source-map-api: FAIL

# missing support for script.sourceMapURL
test-node-output-sourcemaps: FAIL
test-vm-source-map-url: FAIL

# Worker resource limits are not supported
test-worker-resource-limits: FAIL
test-worker-nearheaplimit-deadlock: SKIP

# Custom v8::ArrayBuffer::Allocator is not supported
test-worker-sharedarraybuffer-from-worker-thread: SKIP

# Profiling is not supported
test-cli-node-options: FAIL
test-tick-processor-arguments: FAIL

# v8::Object::GetConstructorName() returns `Klass` for
# Object.setPrototypeOf(new Klass(), null) (which graal-nodejs is unable to return)
test-util-format: FAIL

# v8::Object::GetConstructorName() returns `Klass` for
# Object.setPrototypeOf(new Klass(), null) (which graal-nodejs is unable to return) +
# some differences in the handling of weak collections
test-util-inspect: FAIL

# v8.cachedDataVersionTag() not supported
test-v8-version-tag: FAIL

# Different error message (Unexpected token } x Expected eof but found }) +
# missing support for lineOffset and columnOffset in ScriptOrigin
test-vm-basic: FAIL

# Missing support for lineOffset and columnOffset in ScriptOrigin
test-vm-context: FAIL

# WebAssembly is not enabled by default
test-fetch: FAIL
test-fetch-disabled: FAIL
test-http-response-setheaders: FAIL
test-single-executable-application: SKIP
test-vm-codegen: FAIL
test-whatwg-webstreams-transfer: FAIL
test-worker-message-port-wasm-module: FAIL
test-worker-message-port-wasm-threads: FAIL

# Custom MicrotaskQueue is not supported
test-vm-timeout-escape-promise: FAIL
test-vm-timeout-escape-promise-module: FAIL
test-vm-timeout-escape-promise-2: FAIL

# run-time user-land snapshots are not supported
test-snapshot-api: FAIL
test-snapshot-argv1: FAIL
test-snapshot-basic: FAIL
test-snapshot-cjs-main: FAIL
test-snapshot-dns-lookup-localhost: FAIL
test-snapshot-dns-lookup-localhost-promise: FAIL
test-snapshot-dns-resolve-localhost: FAIL
test-snapshot-dns-resolve-localhost-promise: FAIL
test-snapshot-error: FAIL
test-snapshot-eval: FAIL
test-snapshot-gzip: FAIL
test-snapshot-incompatible: FAIL
test-snapshot-namespaced-builtin: FAIL
test-snapshot-typescript: FAIL
test-snapshot-umd: FAIL
test-snapshot-warning: FAIL
test-snapshot-weak-reference: FAIL

# Contains an unused invalid regular expression
# (which works on V8 where the regexp syntax check is lazy).
test-trace-exit: FAIL

# Tracing is not supported
test-throw-error-with-getter-throw-traced: FAIL
test-throw-undefined-or-null-traced: FAIL
test-trace-atomics-wait: SKIP
test-trace-events-all: SKIP
test-trace-events-api: SKIP
test-trace-events-async-hooks: SKIP
test-trace-events-async-hooks-dynamic: SKIP
test-trace-events-async-hooks-worker: SKIP
test-trace-events-binding: SKIP
test-trace-events-bootstrap: SKIP
test-trace-events-category-used: SKIP
test-trace-events-console: SKIP
test-trace-events-environment: SKIP
test-trace-events-file-pattern: SKIP
test-trace-events-fs-async: SKIP
test-trace-events-fs-sync: SKIP
test-trace-events-http: SKIP
test-trace-events-metadata: SKIP
test-trace-events-net: SKIP
test-trace-events-none: SKIP
test-trace-events-process-exit: SKIP
test-trace-events-promises: SKIP
test-trace-events-threadpool: SKIP
test-trace-events-v8: SKIP
test-trace-events-vm: SKIP
test-trace-events-worker-metadata: SKIP
test-trace-events-worker-metadata-with-name: SKIP

# Unclassified
test-async-hooks-async-await: FAIL
test-async-hooks-http-parser-destroy: SKIP
test-async-local-storage-contexts: FAIL
test-crypto-op-during-process-exit: SKIP
test-crypto-sign-verify: FAIL
test-diagnostics-channel-tracing-channel-promise-run-stores: FAIL
test-domain-no-error-handler-abort-on-uncaught-0: FAIL
test-domain-no-error-handler-abort-on-uncaught-1: FAIL
test-domain-no-error-handler-abort-on-uncaught-2: FAIL
test-domain-no-error-handler-abort-on-uncaught-3: FAIL
test-domain-no-error-handler-abort-on-uncaught-4: FAIL
test-domain-no-error-handler-abort-on-uncaught-5: FAIL
test-domain-no-error-handler-abort-on-uncaught-6: FAIL
test-domain-no-error-handler-abort-on-uncaught-7: FAIL
test-domain-no-error-handler-abort-on-uncaught-8: FAIL
test-domain-no-error-handler-abort-on-uncaught-9: FAIL
test-domain-throw-error-then-throw-from-uncaught-exception-handler: FAIL
test-fs-promises-file-handle-close: FAIL
test-gc-http-client-connaborted: SKIP
test-gc-net-timeout: SKIP
test-gc-tls-external-memory: SKIP
test-http-server-keepalive-req-gc: SKIP
test-http2-response-splitting: SKIP
test-net-connect-memleak: FAIL
test-promise-hook-on-resolve: FAIL
test-repl: FAIL
test-runner-misc: FAIL
test-runner-output: FAIL
test-runner-reporters: FAIL
test-runner-watch-mode: SKIP
test-strace-openat-openssl: FAIL
test-tls-connect-memleak: FAIL
test-ttywrap-stack: FAIL
test-vm-global-setter: FAIL
test-vm-low-stack-space: SKIP
test-vm-new-script-new-context: FAIL
test-vm-syntax-error-stderr: FAIL
test-worker-cleanexit-with-js: SKIP
test-worker-cleanexit-with-moduleload: SKIP
test-worker-error-stack-getter-throws: FAIL
test-worker-stack-overflow-stack-size: SKIP
test-zlib-invalid-input-memory: FAIL
test-zlib-unused-weak: FAIL

# Fails randomly
test-http-outgoing-end-cork: SKIP
test-http2-server-rst-stream: SKIP
test-signal-args: PASS,FAIL
# GC-based random failures
test-domain-async-id-map-leak: SKIP
test-async-hooks-destroy-on-gc: SKIP

# Random OutOfMemoryError: Garbage-collected heap size exceeded.
test-worker-init-failure: SKIP

# RangeError: Maximum call stack size exceeded, or:
# Error: async hook stack has become corrupted (actual: 69, expected: 68)
test-async-hooks-recursive-stack-runInAsyncScope: PASS,FAIL

[$system==solaris]
test-http2-respond-file-fd-invalid : FAIL

# SIGBUS at DES_encrypt2.constprop
test-crypto: FAIL
test-crypto-binary-default: FAIL
test-crypto-cipheriv-decipheriv: FAIL
test-crypto-rsa-dsa: FAIL
test-https-pfx: FAIL
test-tls-multi-pfx: FAIL
test-tls-ocsp-callback: FAIL
test-tls-passphrase: FAIL

### Graal-specific end ###

[$system==win32]
# https://github.com/nodejs/node/issues/41206
test-crypto-keygen: PASS,FLAKY
# https://github.com/nodejs/node/issues/41201
test-fs-rmdir-recursive: PASS, FLAKY
# https://github.com/nodejs/node/issues/49985
test-runner-watch-mode: PASS, FLAKY
# https://github.com/nodejs/node/issues/50295
test-cli-node-options: PASS, FLAKY

# Windows on x86
[$system==win32 && $arch==ia32]
test-worker-nearheaplimit-deadlock: PASS, FLAKY

# Windows on ARM
[$system==win32 && $arch==arm64]

[$system==linux]
# https://github.com/nodejs/node/issues/39368
test-domain-error-types: PASS,FLAKY
# https://github.com/nodejs/node/issues/47420
test-file-write-stream4: PASS,FLAKY
# https://github.com/nodejs/node/issues/43465
test-http-server-request-timeouts-mixed: PASS, FLAKY

[$system==linux || $system==win32]
# https://github.com/nodejs/node/issues/49605
test-runner-watch-mode: PASS,FLAKY

[$system==macos]
# https://github.com/nodejs/node/issues/42741
test-http-server-headers-timeout-keepalive: PASS,FLAKY
test-http-server-request-timeout-keepalive: PASS,FLAKY
# https://github.com/nodejs/node/issues/43465
test-http-server-request-timeouts-mixed: PASS,FLAKY
# https://github.com/nodejs/node/issues/50243
test-inspector-async-stack-traces-set-interval: PASS, FLAKY

# Graal.js-specific
test-error-reporting: FAIL
test-http2-respond-file-fd-invalid: FAIL

[$arch==arm || $arch==arm64]
# https://github.com/nodejs/node/pull/31178
test-crypto-dh-stateless: SKIP
test-crypto-keygen: SKIP
# https://github.com/nodejs/node/issues/47297
test-wasm-web-api: SKIP

[$system==solaris] # Also applies to SmartOS
# https://github.com/nodejs/node/issues/43457
test-domain-no-error-handler-abort-on-uncaught-0: PASS, FLAKY
test-domain-no-error-handler-abort-on-uncaught-1: PASS,FLAKY
test-domain-no-error-handler-abort-on-uncaught-2: PASS,FLAKY
test-domain-no-error-handler-abort-on-uncaught-3: PASS,FLAKY
test-domain-no-error-handler-abort-on-uncaught-4: PASS,FLAKY
test-domain-no-error-handler-abort-on-uncaught-5: PASS, FLAKY
test-domain-no-error-handler-abort-on-uncaught-6: PASS, FLAKY
test-domain-no-error-handler-abort-on-uncaught-7: PASS, FLAKY
test-domain-no-error-handler-abort-on-uncaught-8: PASS, FLAKY
test-domain-no-error-handler-abort-on-uncaught-9: PASS, FLAKY
test-domain-throw-error-then-throw-from-uncaught-exception-handler: PASS, FLAKY
test-domain-with-abort-on-uncaught-exception: PASS, FLAKY

[$system==freebsd]
# https://github.com/nodejs/node/issues/31727
test-fs-stat-bigint: PASS,FLAKY
# https://github.com/nodejs/node/issues/31280
test-worker-message-port-message-before-close: PASS,FLAKY

[$system==ibmi]
# https://github.com/nodejs/node/pull/30819
test-child-process-fork-net-server: SKIP
test-cli-node-options: SKIP
test-cluster-shared-leak: SKIP
test-http-writable-true-after-close: SKIP
test-http2-connect-method: SKIP
test-net-error-twice: SKIP
# https://github.com/libuv/libuv/pull/2782
test-net-allow-half-open: SKIP
test-net-keepalive: SKIP
test-net-persistent-keepalive: SKIP
test-net-socket-close-after-end: SKIP
test-net-socket-connect-without-cb: SKIP
test-net-socket-connecting: SKIP
test-net-socket-ready-without-cb: SKIP
test-net-write-after-end-nt: SKIP
test-tls-env-extra-ca: SKIP
# https://github.com/nodejs/node/pull/34209
test-dgram-error-message-address: SKIP
# https://github.com/nodejs/node/issues/36929
test-crypto-secure-heap: SKIP
# https://github.com/nodejs/node/issues/39683
test-dgram-connect: PASS, FLAKY
test-http-client-parse-error: PASS, FLAKY
test-http-multi-line-headers: PASS, FLAKY
test-http-pipeline-requests-connection-leak: PASS, FLAKY
test-http-server-unconsume: PASS, FLAKY
test-http-upgrade-advertise: PASS, FLAKY
test-tls-client-mindhsize: PASS, FLAKY
test-tls-write-error: PASS, FLAKY
# https://github.com/nodejs/node/issues/48047
test-http-pipeline-flood: SKIP

[$asan==on]
# https://github.com/nodejs/node/issues/39655
test-cluster-primary-error: PASS, FLAKY

[$arch==s390x]
# https://github.com/nodejs/node/issues/50222
test-inspector-async-hook-setup-at-inspect-brk: PASS, FLAKY
